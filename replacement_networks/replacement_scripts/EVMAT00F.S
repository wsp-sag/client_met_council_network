; Do not change filenames or add or remove FILEI/FILEO statements using an editor. Use Cube/Application Manager.
RUN PGM = MATRIX MSG = 'Update Zonal Database'
FILEI ZDATI[1] = "%SCENARIO_DIR%\zones_%PREV_ITER%.dbf"
FILEO RECO[1] = "%SCENARIO_DIR%\zones_%ITER%.dbf",
  FORM = 10.0, FIELDS = ZONE, ZONEID, POPULATION, HOUSEHOLDS, RET_EMP, NRET_EMP,
                        AMC_EMP, MAN_EMP, OFF_EMP, MED1_EMP, MED2_EMP, RST_EMP,
                        K12_EMP, ENT_EMP, TOT_EMP,
  FORM = 10.8, FIELDS = AREA, MIX_DENS,
  FORM = 10.0, FIELDS = TERM_TIME,
  FORM = 10.0, FIELDS = PARK_COST, NONWRKPRK,
  FORM = 10.0, FIELDS = ENROLLED, ENROLLED2, ENROLLED5, ENROLLED10,
  FORM = 10.8, FIELDS = TETRACC15, TEHWYACC10, REHWYACC10, NEHWYACC10, MEHWYACC10,
  FORM = 10.2, FIELDS = EXT_DIST,
  FORM = 10.0, FIELDS = CBD, SUBURB3, SUBURB2, RURAL,
  FORM = 10.8, FIELDS = HHDENSITY, LOGMXDENS, RETEMPDEN, POPDENS, TOTEMPDEN, TRHWACCRAT,
  FORM = 10.0, FIELDS = TW_ACC, SCH1NUM1, SCH1NUM2, SCH1NUM3, SCH1NUM4, SCH1NUM5,
                        SCH1NUM6, SCH1NUM7, SCH1NUM8, SCH1NUM9, SCH1NUM10,
                        SCH2NUM1, SCH2NUM2, SCH2NUM3, SCH2NUM4, SCH2NUM5, SCH2NUM6,
                        SCH2NUM7, SCH2NUM8, SCH2NUM9, SCH2NUM10, SCH3NUM1, SCH3NUM2,
                        SCH3NUM3, SCH3NUM4, SCH3NUM5, SCH3NUM6, SCH3NUM7, SCH3NUM8,
                        SCH3NUM9, SCH3NUM10, DISTRICT
FILEI ZDATI[6] = "%SCENARIO_DIR%\universityenrollment.csv",
  Z = #1, ENROLLED2 = #3, ENROLLED5 = #4, ENROLLED10 = #5
FILEI ZDATI[5] = "%SCENARIO_DIR%\TAZ_SchoolList.csv",
  Z = #1, SCH1NUM1 = #2, SCH1NUM2 = #3, SCH1NUM3 = #4, SCH1NUM4 = #5,
  SCH1NUM5 = #6, SCH1NUM6 = #7, SCH1NUM7 = #8, SCH1NUM8 = #9, SCH1NUM9 = #10,
  SCH1NUM10 = #11, SCH2NUM1 = #12, SCH2NUM2 = #13, SCH2NUM3 = #14, SCH2NUM4 = #15,
  SCH2NUM5 = #16, SCH2NUM6 = #17, SCH2NUM7 = #18, SCH2NUM8 = #19, SCH2NUM9 = #20,
  SCH2NUM10 = #21, SCH3NUM1 = #22, SCH3NUM2 = #23, SCH3NUM3 = #24, SCH3NUM4 = #25,
  SCH3NUM5 = #26, SCH3NUM6 = #27, SCH3NUM7 = #28, SCH3NUM8 = #29, SCH3NUM9 = #30,
  SCH3NUM10 = #31
FILEI ZDATI[4] = "%SCENARIO_DIR%\distancetoexternal.csv",
  Z = #1, EXT_DIST = #2
FILEI ZDATI[3] = "%SCENARIO_DIR%\transit_accessibility.csv",
  Z = #1, TETRACC15 = #6
FILEI ZDATI[2] = "%SCENARIO_DIR%\highway_accessibility.csv",
  Z = #1, TEHWYACC10 = #5, REHWYACC10 = #11, NEHWYACC10 = #17, MEHWYACC10 = #23


ZONES = %int_zones%

; Update all variables
RO.ZONE = ZI.1.ZONE[i]
RO.ZONEID = ZI.1.ZONEID[i]
RO.POPULATION = ZI.1.POPULATION[i]
RO.HOUSEHOLDS = ZI.1.HOUSEHOLDS[i]
RO.RET_EMP = ZI.1.RET_EMP[i]
RO.NRET_EMP = ZI.1.NRET_EMP[i]
RO.AMC_EMP = ZI.1.AMC_EMP[i]
RO.MAN_EMP = ZI.1.MAN_EMP[i]
RO.OFF_EMP = ZI.1.OFF_EMP[i]
RO.MED1_EMP = ZI.1.MED1_EMP[i]
RO.MED2_EMP = ZI.1.MED2_EMP[i]
RO.RST_EMP = ZI.1.RST_EMP[i]
RO.K12_EMP = ZI.1.K12_EMP[i]
RO.ENT_EMP = ZI.1.ENT_EMP[i]
RO.TOT_EMP = ZI.1.TOT_EMP[i]
RO.AREA = ZI.1.AREA[i]
RO.MIX_DENS = ZI.1.MIX_DENS[i]
RO.TERM_TIME = ZI.1.TERM_TIME[i]
RO.PARK_COST = ZI.1.PARK_COST[i]
RO.NONWRKPRK = ZI.1.NONWRKPRK[i]
RO.ENROLLED = ZI.1.ENROLLED[i]
RO.ENROLLED2 = ZI.6.ENROLLED2[i]
RO.ENROLLED5 = ZI.6.ENROLLED5[i]
RO.ENROLLED10 = ZI.6.ENROLLED10[i]
RO.TETRACC15 = ZI.3.TETRACC15[i]
RO.TEHWYACC10 = ZI.2.TEHWYACC10[i]
RO.REHWYACC10 = ZI.2.REHWYACC10[i]
RO.NEHWYACC10 = ZI.2.NEHWYACC10[i]
RO.MEHWYACC10 = ZI.2.MEHWYACC10[i]
RO.EXT_DIST = ZI.4.EXT_DIST[i]
RO.CBD = ZI.1.CBD[i]
RO.SUBURB3 = ZI.1.SUBURB3[i]
RO.SUBURB2 = ZI.1.SUBURB2[i]
RO.RURAL = ZI.1.RURAL[i]
RO.HHDENSITY = ZI.1.HHDENSITY[i]
RO.LOGMXDENS = ZI.1.LOGMXDENS[i]
RO.RETEMPDEN = ZI.1.RETEMPDEN[i]
RO.POPDENS = ZI.1.POPDENS[i]
RO.TOTEMPDEN = ZI.1.TOTEMPDEN[i]
RO.TRHWACCRAT = ZI.1.TRHWACCRAT[i]
RO.TW_ACC = ZI.1.TW_ACC[i]
RO.SCH1NUM1 = ZI.5.SCH1NUM1[i]
RO.SCH1NUM2 = ZI.5.SCH1NUM2[i]
RO.SCH1NUM3 = ZI.5.SCH1NUM3[i]
RO.SCH1NUM4 = ZI.5.SCH1NUM4[i]
RO.SCH1NUM5 = ZI.5.SCH1NUM5[i]
RO.SCH1NUM6 = ZI.5.SCH1NUM6[i]
RO.SCH1NUM7 = ZI.5.SCH1NUM7[i]
RO.SCH1NUM8 = ZI.5.SCH1NUM8[i]
RO.SCH1NUM9 = ZI.5.SCH1NUM9[i]
RO.SCH1NUM10 = ZI.5.SCH1NUM10[i]
RO.SCH2NUM1 = ZI.5.SCH2NUM1[i]
RO.SCH2NUM2 = ZI.5.SCH2NUM2[i]
RO.SCH2NUM3 = ZI.5.SCH2NUM3[i]
RO.SCH2NUM4 = ZI.5.SCH2NUM4[i]
RO.SCH2NUM5 = ZI.5.SCH2NUM5[i]
RO.SCH2NUM6 = ZI.5.SCH2NUM6[i]
RO.SCH2NUM7 = ZI.5.SCH2NUM7[i]
RO.SCH2NUM8 = ZI.5.SCH2NUM8[i]
RO.SCH2NUM9 = ZI.5.SCH2NUM9[i]
RO.SCH2NUM10 = ZI.5.SCH2NUM10[i]
RO.SCH3NUM1 = ZI.5.SCH3NUM1[i]
RO.SCH3NUM2 = ZI.5.SCH3NUM2[i]
RO.SCH3NUM3 = ZI.5.SCH3NUM3[i]
RO.SCH3NUM4 = ZI.5.SCH3NUM4[i]
RO.SCH3NUM5 = ZI.5.SCH3NUM5[i]
RO.SCH3NUM6 = ZI.5.SCH3NUM6[i]
RO.SCH3NUM7 = ZI.5.SCH3NUM7[i]
RO.SCH3NUM8 = ZI.5.SCH3NUM8[i]
RO.SCH3NUM9 = ZI.5.SCH3NUM9[i]
RO.SCH3NUM10 = ZI.5.SCH3NUM10[i]
RO.DISTRICT = ZI.1.DISTRICT[i]

; create output dbf

WRITE RECO = 1

ENDRUN
